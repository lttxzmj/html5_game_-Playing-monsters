<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>移动端 HTML5 开发</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animation.css">
    <script type="text/javascript" src="js/lex.js"></script>
    <script type="text/javascript" src="js/jCanvaScript.1.5.18.min.js"></script>
</head>

<body>
    <div>
        <div class="Bg-page1">
        </div>
        <div class=" bg-game">
        </div>
        <canvas id="game" style="position:absolute; z-index: 1"></canvas>
        <div class="typeBar">
            <div class="score">sss</div>
            <div class="time">sss</div>
            <div class="music musicRun">
                <audio src="audio/game.mp3" preload="auto"></audio>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        musicShow();

        function musicShow() {
            var music = document.getElementsByClassName('music')[0];
            var musicClasses = music.classList;
            var au = music.getElementsByTagName('audio')[0];
            bind(music, 'touchstart', function() {
                if (au.paused) {
                    au.play();
                    musicClasses.remove('musicStop');
                    musicClasses.add('musicRun');
                } else {
                    au.pause();
                    musicClasses.remove('musicRun');
                    musicClasses.add('musicStop');
                }
            })
        };
        gamePage();

        function gamePage(option) {
            var game = document.getElementById('game');
            game.width = view().w;
            game.height = view().h;

            var _that = this;
            _that.monster = {
                mon1: function(option) {
                    jc.start(option.canvas, true);
                    var monster1 = new Image();
                    monster1.src = 'imgs/monster1.png';
                    monster1.onload = function() {
                        jc.start(option.canvas);
                        jc.image(monster1, -200, -200, 109, 114).id(option.id).level(2);
                    }
                },
                mon2: function(option) {
                    jc.start(option.canvas, true);
                    var monster2 = new Image();
                    monster2.src = 'imgs/monster2.png';
                    monster2.onload = function() {
                        jc.start(option.canvas);
                        jc.image(monster2, -200, -200, 109, 114).id(option.id).level(2);
                    }
                },
                mon3: function(option) {
                    jc.start(option.canvas, true);
                    var monster3 = new Image();
                    monster3.src = 'imgs/monster3.png';
                    monster3.onload = function() {
                        jc.start(option.canvas);
                        jc.image(monster3, -200, -200, 109, 114).id(option.id).level(2);
                    }
                },
                mon4: function(option) {
                    jc.start(option.canvas, true);
                    var monster4 = new Image();
                    monster4.src = 'imgs/monster4.png';
                    monster4.onload = function() {
                        jc.start(option.canvas);
                        jc.image(monster4, -200, -200, 109, 114).id(option.id).level(2);
                    }
                },
                m1: [180, 138],
                m2: [146, 84],
                m3: [103, 94],
                m2: [92, 107]
            };

            //添加控制怪物出现次数的函数
            _that.time = [10];
            _that.nonNum = [];
            var num = 1;

            createNum();

            function createNum() {
                for (var i = 0; i < num; i++) {
                    _that.nonNum.push(num);
                };
                num++;
                if (num < 30) {
                    createNum();
                };
            };

            _that.score = 0;
            _that.MinX = 50;
            _that.MinY = 50;
            _that.MaxX = view().w - 50;
            _that.MaxY = view().h - 50;
            _that.monomer = {};
            _that.position = {};
            _that.num = 0;

            _that.MaxX = _that.w - 120;
            _that.maxY = _that.h - 150;
            _that.roundT = 20000; //怪物公转一圈所用时间
            _that.speed = 18; //所有怪物变化间隔时间（毫秒）

            createMonste();

            function createMonster() {
                for (var i = 0; i < _that.nonNum[score]; i++) {
                    var mon = getNum({
                        min: 1,
                        max: 4,
                        num: 1
                    })[0];
                    _that.monster['mon' + mon]({
                        canvas: 'game',
                        id: 'mon' + i + _that.score
                    });
                    var monM = new monMove({
                        obj: 'mon' + i + _that.score
                    });
                }
            };

            function monMove(option) {
                // 指定初始位置
                var _this = this;
                _this.obj = option.obj;
                _this.jdC = 200;
                _this.jd = option.jd || -2;
                _this.r = option.r || 200;
                _this.clockwise = option.clockwise ? false : true;

                _this.changeNum = ((_that.MaxX - _that.Minx) + (_that.MaxY - _that.MinY)) * 2 / (_that.roundT / _that.speed);

                var firstPositionArea = getNum({
                    min: 1,
                    max: 4,
                    num: 1
                });
                switch (firstPositionArea) {
                    case 1:
                        _that.X = getNum({
                            min: _that.MinX,
                            max: _that.MaxX,
                            num: 1
                        })[0];
                        _that.Y = _that.MinY;
                        break;
                    case 2:
                        _that.X = _that.MinX;
                        _that.Y = getNum({
                            min: _that.MinY,
                            max: _that.MaxY,
                            num: 1
                        })[0];
                        break;
                    case 3:
                        _that.X = getNum({
                            min: _that.MinX,
                            max: _that.MaxX,
                            num: 1
                        })[0];
                        _that.Y = _that.MaxY;
                        break;
                    case 4:
                        _that.X = _that.MaxX;
                        _that.Y = getNum({
                            min: _that.MinY,
                            max: _that.MaxY,
                            num: 1
                        })[0];
                        break;
                }
                _that.timer = setInterval(function() {
                    _that.run();
                }, _that.speed);
            };

            monMove.prototype.run = function() {
                var _that = this;
                if (_that.X <= _that.MaxX && _that.Y == _that.MinY && _that.X > _that.MinX) {
                    // 这是第一条线
                    _that.X = _that.X - _that.changeNum;
                    if (_that.X < this.MinX) {
                        _that.X = this.MinX;
                    }
                } else if (_that.X == _that.MinX && _that.Y < _that.MaxY) {
                    // 这是第二条线
                    _that.Y = _that.Y + _that.changeNum;
                    if (_that.Y > this.MaxY) {
                        _that.Y = this.MaxY;
                    }
                } else if (_that.X < _that.MaxX && _that.Y == _that.MaxY) {
                    // 这是第三条线
                    _that.X = _that.X + _that.changeNum;
                    if (_that.X > this.MaxX) {
                        _that.X = this.MaxX;
                    }
                } else if (_that.X == _that.MaxX && _that.Y <= _that.MaxY) {
                    // 这是第四条线
                    _that.Y = _that.Y - _that.changeNum;
                    if (_that.Y < this.MinY) {
                        _that.Y = this.MinY;
                    }
                };
                jc('#' + _that.obj).animate({
                    x: _that.x,
                    y: _that.Y
                }, 1)
            };
        };
    </script>
</body>

</html>
/body>

</html>
